{% extends 'base.html' %}

{% block content %} 
<header class="py-4">
    <nav class="navbar navbar-expand-md fixed-top bg-dark">
        <div class="container-fluid">
            <!-- Bouton qui bascule le sidebar sur petits écrans -->
            <button type="button" id="sidebarCollapse" class="btn bg-dark ms-md-0 mt-5 border-0">
                <h4 class="text-light"><span>Nos Cours</span></h4>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link text-primary fw-bold" href="{% url 'login' %}">Se connecter</a>
                    </li>
                    {% if user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link text-primary fw-bold" href="{% url 'logout' %}">Se déconnecter</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="row mt-2">
    <!-- Sidebar : sur desktop toujours visible, masqué sur sm -->
    <div class="col-auto wrapper">
        <nav id="sidebar" class="text-light bg-dark d-none d-md-block">
            <div class="sidebar-header text-light bg-dark">
                <h3>Blog DevOps</h3>
            </div>
            <ul class="list-unstyled components">
                <li>
                    <a href="#pageSubmenuri" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                        Les réseaux informatiques
                    </a>
                    <ul class="collapse list-unstyled" id="pageSubmenuri">
                        {% for articl in articles %}
                        {% if articl.category.name == "Réseaux Informatiques" %}
                        <li><a href="{% url 'detail' articl.id %}">{{ articl.title }}</a></li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </li>
                <li>
                        <a href="#pageSubmenudev" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                            Développement web
                        </a>
                        <ul class="collapse list-unstyled" id="pageSubmenudev">
                            {# Affiche les articles de Développement web hors ceux des langages spécifiques #}
                            {% for articl in articles %}
                            {% if articl.category.name == "Developpement web" and articl.title == "Introduction" %}
                                    <li><a href="{% url 'detail' articl.id %}">{{ Introduction }}</a></li>
                                {% endif %}
                               
                            {% endfor %}
                            <li>
                                <a href="#submenuLangages" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                                    Quelques langages
                                </a>
                                <ul class="collapse list-unstyled" id="submenuLangages">
                                    
                                      {% for articl in articles %}
                                      {% if articl.category.name == "Developpement web" and articl.title == "Python" %}
                                          <li><a href="{% url 'detail' articl.id %}">{{ articl.title }}</a></li>
                                      {% endif %}
                                      {% if articl.category.name == "Developpement web" and articl.title == "PHP" %}
                                          <li><a href="{% url 'detail' articl.id %}">{{ articl.title }}</a></li>
                                      {% endif %}
                                      {% if articl.category.name == "Developpement web" and articl.title == "Go" %}
                                          <li><a href="{% url 'detail' articl.id %}">{{ articl.title }}</a></li>
                                      {% endif %}
                                  {% endfor %}
                                    
                                </ul>
                            </li>
                        </ul>
                    </li>
                   <li>
                    <a href="#pageSubmenubr" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Bureautique</a>
                    <ul class="collapse list-unstyled" id="pageSubmenubr">
                        {% for articl in articles %}
                        {% if articl.category.name == "Bureautique" %}
                         <li><a href="{% url 'detail' articl.id %}">{{ articl.title }}</a></li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </li>
                <li>
                    <a href="#pageSubmenuops" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                        DevOps
                    </a>
                    <ul class="collapse list-unstyled" id="pageSubmenuops">
                        {% for articl in articles %}
                        {% if articl.category.name == "DevOps" %}
                        <li><a href="{% url 'detail' articl.id %}">{{ articl.title }}</a></li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </li>
                <li>
                    <a href="#pageSubmenuads" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                        Administration systèmes
                    </a>
                    <ul class="collapse list-unstyled" id="pageSubmenuads">
                        {% for articl in articles %}
                        {% if articl.category.name == "Réseaux Informatiques" %}
                        <li><a href="{% url 'detail' articl.id %}">{{ articl.title }}</a></li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </li>
                <li><a href="https://portfolio-kodji.vercel.app/">Qui sommes-nous?</a></li>
            </ul>
        </nav>
    </div>

    <!-- Contenu principal : on lui attribue l'ID mainContent -->
    <div id="mainContent" class="col text-light d-block">
        <div class="display-2 mt-3 mb-3">
            <h2 class="text-warning">{{ article.title|safe }}</h2>
        </div>
        <!-- Parties de l'article -->
        <div id="part-1" class="part">
            <div>{{ article.content|safe }}</div>
        </div>

        <!-- Pagination Responsive -->
        <div class="row mt-4 mb-4">
            <div class="col-md-6 col-sm-12 mt-3">
                <div class="card text-warning bg-dark border-0" id="prevCard" onclick="changeArticle(-1)" style="cursor:pointer;">
                    <div class="card-header text-start bg-dark">Précédent</div>
                    <div class="card-body">
                        <h4 class="card-title text-center" id="prevTitle"></h4>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-sm-12 mt-3">
                <div class="card text-warning bg-dark border-0" id="nextCard" onclick="changeArticle(1)" style="cursor:pointer;">
                    <div class="card-header text-center bg-dark">Suivant</div>
                    <div class="card-body">
                        <h4 class="card-title text-center" id="nextTitle"></h4>
                    </div>
                </div>
            </div>
        </div>
        <div class="mb-4">
            <a href="http://ko-fi.com/kodjikanka">
                <h4 class="text-warning">Vous avez apprécié ce contenu ?</h4>
                <p>Prouvez-le moi en m'offrant du café</p>
                <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script>
                <div class="row">
                    <div class="col-md-6 mt-3">
                        <script type='text/javascript'>
                            kofiwidget2.init('Support Me on Ko-fi', '#29abe0', 'G2G7140N33');
                            kofiwidget2.draw();
                        </script> 
                    </div>
                    <div class="col-md-6 mt-3">
                        <a href="tel:696903285">
                            <img class="img-fluid" style="width:182px; height:45px;" src="../../../static/mobile-money.jpg" alt="Mobile Money">
                        </a>
                    </div>
                </div>
                <h5 class="mt-3">Votre soutien m'aide à continuer à partager du contenu de qualité.</h5>
            </a>
        </div>
    </div>
</div>

<!-- Script de pagination -->
<script>
    // Récupère tous les liens d'articles dans la sidebar dont l'URL commence par "/articles/"
    const articleLinks = Array.from(document.querySelectorAll('#sidebar a[href^="/articles/"]'));
    // Trouve l'index du lien correspondant à l'URL actuelle
    const currentUrl = window.location.pathname;
    let currentIndex = articleLinks.findIndex(link => link.getAttribute('href') === currentUrl);

    // Fonction pour rediriger vers l'article suivant ou précédent
    function changeArticle(direction) {
        if (currentIndex === -1) return;
        const newIndex = currentIndex + direction;
        if (newIndex >= 0 && newIndex < articleLinks.length) {
            window.location.href = articleLinks[newIndex].getAttribute('href');
        }
    }

    // Au chargement, met à jour le contenu des cartes de navigation
    document.addEventListener("DOMContentLoaded", function() {
        const prevTitleElem = document.getElementById('prevTitle');
        const nextTitleElem = document.getElementById('nextTitle');
        const prevCard = document.getElementById('prevCard');
        const nextCard = document.getElementById('nextCard');

        if (currentIndex > 0) {
            const prevTitle = articleLinks[currentIndex - 1].textContent.trim();
            prevTitleElem.textContent = prevTitle;
        } else {
            prevCard.style.display = 'none';
        }

        if (currentIndex !== -1 && currentIndex < articleLinks.length - 1) {
            const nextTitle = articleLinks[currentIndex + 1].textContent.trim();
            nextTitleElem.textContent = nextTitle;
        } else {
            nextCard.style.display = 'none';
        }
    });
</script>

<!-- Script pour basculer l'affichage du sidebar et du contenu sur petits écrans -->
<script>
document.getElementById("sidebarCollapse").addEventListener("click", function() {
    if(window.innerWidth < 768){
        var sidebar = document.getElementById("sidebar");
        var mainContent = document.getElementById("mainContent");
        // Si le sidebar est actuellement affiché, le masquer et afficher le contenu principal
        if(sidebar.classList.contains("d-block")){
            sidebar.classList.remove("d-block");
            sidebar.classList.add("d-none");
            mainContent.classList.remove("d-none");
            mainContent.classList.add("d-block");
        } else {
            // Sinon, afficher le sidebar et masquer le contenu principal
            sidebar.classList.remove("d-none");
            sidebar.classList.add("d-block");
            mainContent.classList.remove("d-block");
            mainContent.classList.add("d-none");
        }
    }
});
</script>
{% endblock %}